# MPPI单条路径流程演示说明

## 概述

这个演示展示了MPPI（Model Predictive Path Integral）控制器中一条控制路径的完整流程。通过命令行输出，你可以清楚地看到MPPI是如何工作的。

## 演示文件

- `mppi_path_demo_fixed.py` - 修正版的MPPI路径演示
- `simple_mppi_demo.py` - 简化版演示
- `mppi_path_demo.py` - 完整版演示（需要修复导入问题）

## 演示流程

### 1. 📊 步骤1: 生成控制序列样本

```
生成了 6 个控制序列样本:
  样本1: [1.07450712 1.07926035 1.29715328 1.32845448 0.96487699]
  样本2: [0.96487946 1.33688192 1.31511521 1.02957884 1.08138401]
  ...
```

**说明**: MPPI围绕`mean_sequence`生成随机样本，每个样本代表一个可能的控制序列。

### 2. 💰 步骤2: 计算每个样本的代价

```
  样本1: 代价=9118886.79
    Solar Vol: [1.07450712 1.07926035 1.29715328 1.32845448 0.96487699]
    温度: [ -5.46432145  -9.81283003 -16.93788958 -24.46181187 -27.35276404]
    功率: [42.98028492 43.17041419 51.88613123 53.13817914 38.59507975]
    光合作用: [7.47165819 7.03539282 7.5315457  6.71376824 4.59737218]
    控制量变化分析:
      步骤0: u0=1.075, Δu=0.075 (升温)
      步骤1: u0=1.079, Δu=0.005 (升温)
      步骤2: u0=1.297, Δu=0.218 (升温)
      步骤3: u0=1.328, Δu=0.031 (升温)
      步骤4: u0=0.965, Δu=-0.364 (降温)
```

**说明**: 
- 对每个样本进行植物仿真预测
- 计算代价函数（包含光合作用、温度约束、功率等）
- **关键**: 控制量变化分析显示热力学模型如何根据`Δu`选择升温/降温模型

### 3. ⚖️ 步骤3: 计算Softmax权重

```
最小代价: 9118886.79
温度参数: 0.5
权重分布:
  样本1: 代价=9118886.79, 权重=1.0000
  样本2: 代价=202580254.09, 权重=0.0000
  ...
```

**说明**: 使用Softmax函数将代价转换为权重，代价越低权重越高。

### 4. 🎯 步骤4: 计算最优控制序列

```
加权平均序列: [1.07450712 1.07926035 1.29715328 1.32845448 0.96487699]
最优控制量: 1.075
```

**说明**: 通过加权平均得到最优控制序列，第一个元素就是当前时刻的最优控制量。

### 5. 🚀 步骤5: 执行最优控制

```
执行结果:
  Solar Vol: 1.075
  新温度: -219.19°C
  功率: 42.98W
  光合作用: 0.00
  控制量变化: Δu=0.075 (升温)
```

**说明**: 执行最优控制，更新植物状态。

## 关键要点

### 1. 🔥 MPPI围绕mean_sequence生成随机样本
- `mean_sequence`是参考控制轨迹
- 通过添加噪声生成候选控制序列

### 2. 🌡️ 热力学模型根据控制量变化选择升温/降温模型
- `Δu = u_current - u_previous`
- `Δu > 0` → 升温模型
- `Δu < 0` → 降温模型

### 3. 💰 代价函数包含多个组成部分
- 光合作用代价（负值，因为要最大化）
- 温度约束惩罚
- 功率代价
- 控制变化代价

### 4. ⚖️ Softmax权重基于代价计算
- 代价越低，权重越高
- 温度参数控制权重分布的尖锐程度

### 5. 🎯 加权平均得到最优控制序列
- 所有样本的加权平均
- 第一个元素是当前时刻的最优控制量

## 运行演示

```bash
cd A/Project1/LED_MPPI_Controller
python examples/mppi_path_demo_fixed.py
```

## 注意事项

1. 确保`Thermal/exported_models`目录中有必需的模型文件
2. 演示使用固定的随机种子，便于复现结果
3. 温度预测可能不准确，这是演示模型的限制
4. 实际应用中需要更精确的模型和参数调优
